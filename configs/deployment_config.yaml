# Deployment Configuration
# Settings for model deployment and batch inference

deployment:
  # Model serving configuration
  serving:
    enabled: false  # Set to true when ready for real-time serving
    framework: sklearn  # Options: sklearn, tensorflow, pytorch
    server_type: mlflow  # Options: mlflow, seldon, kserve, bentoml

    resources:
      cpu: 1
      memory: 2Gi
      replicas: 2
      autoscaling:
        enabled: true
        min_replicas: 2
        max_replicas: 10
        target_cpu_utilization: 70

    endpoint:
      timeout: 30  # seconds
      health_check_path: /health
      predict_path: /predict

  # Batch inference configuration
  batch_inference:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM UTC
    input_data_path: null  # Will use production data source
    output_path: null  # Will use artifact store
    batch_size: 1000

    resources:
      cpu: 2
      memory: 4Gi

# Model promotion strategy
promotion:
  strategy: manual  # Options: manual, automatic, approval_required

  # Approval requirements for production
  production_requirements:
    min_approvers: 2
    required_checks:
      - validation_passed
      - performance_threshold_met
      - security_scan_passed
      - drift_check_passed

  # Canary deployment settings
  canary:
    enabled: false
    initial_traffic_percentage: 10
    increment_percentage: 10
    evaluation_period_minutes: 60

# Monitoring and alerting
monitoring:
  enabled: true

  metrics:
    - prediction_latency
    - prediction_throughput
    - model_accuracy
    - data_drift_score
    - feature_importance_shift

  alerts:
    - name: high_prediction_latency
      threshold: 1000  # milliseconds
      severity: warning

    - name: accuracy_degradation
      threshold: 0.75  # Below 75% accuracy
      severity: critical

    - name: data_drift_detected
      threshold: 0.3  # Drift score > 0.3
      severity: warning

  logging:
    sample_rate: 0.1  # Log 10% of predictions
    include_features: true
    include_predictions: true

# Data drift detection
drift_detection:
  enabled: true
  reference_dataset: training  # Options: training, validation, custom
  detection_methods:
    - kolmogorov_smirnov
    - population_stability_index
  alert_threshold: 0.3
  check_frequency: daily

# Model registry settings
registry:
  backend: mlflow  # Options: mlflow, s3, gcs, azure_blob
  versioning: semantic  # Options: semantic, timestamp, hash
  retention_policy:
    keep_production_models: true
    keep_staging_models_days: 90
    keep_archived_models_days: 30

# Security and compliance
security:
  encryption_at_rest: true
  encryption_in_transit: true

  access_control:
    require_approval_for_production: true
    allowed_deployment_roles:
      - mlops_engineer
      - platform_admin

  audit:
    log_all_predictions: false  # GDPR/HIPAA consideration
    log_model_access: true
    log_promotion_events: true
    retention_days: 365

# Environment-specific overrides
environments:
  staging:
    serving:
      replicas: 1
    monitoring:
      sample_rate: 1.0  # Log 100% in staging

  production:
    serving:
      replicas: 3
    monitoring:
      sample_rate: 0.1  # Log 10% in production
      alerts:
        - name: high_error_rate
          threshold: 0.05  # 5% error rate
          severity: critical
